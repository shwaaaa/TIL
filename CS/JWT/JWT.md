# JWT

## JWT란?

JWT(Json Web Token)은 위와 같은 일련의 과정 속에서 나타난 하나의 인터넷 표준 인증 방식 이다.

JWT는 웹 표준을 따르고 있으며, JSON 객체를 사용하여 정보를 전달한다.

그리고, 필요한 모든 정보를 한 객체에 담아서 전달하기 때문에 JWT 한 가지로 인증을 마칠 수 있다.

***

## JWT의 구조

```
HEADER . PAYLOAD . SIGNATURE
  헤더      내용        서명
```

위와 같이 헤더, 내용, 서명이 '.(dot)'을 구분자로 하여 JWT 토큰 1개를 이룬다

### Header

![image](https://cdn.discordapp.com/attachments/1098858102582956064/1188443394545041561/2023-12-24_8.29.37.png?ex=659a8b29&is=65881629&hm=1cc4700c19486e9a30e23378a0921598ed1d98de80d8eb544cd9fd68f09877f3&)

header에는 보통 토큰의 타입이나, 서명 생성에 어떤 알고리즘이 사용되었는지 저장한다.

지금 같은 경우에는 현재 토큰의 타입이 JWT이고, 앞서 이야기했던 개인키로 HS512 알고리즘이 적용되어 암호화가 되어있다고 확인할 수 있다.

### Payload

![image](https://cdn.discordapp.com/attachments/1098858102582956064/1188443823278411797/2023-12-24_8.31.19.png?ex=659a8b8f&is=6588168f&hm=33fbdda70b7f2a655482ffaea503a060930c4cd8e2f51ac75d9574de3649c621&)

payload에는 보통 Claim이라는 사용자에 대한, 혹은 토큰에 대한 property를 key-value의 형태로 저장한다.

Claim이라는 말 그대로 토큰에서 사용할 정보의 조각인 셈이다.

표준 스펙상 key의 이름은 3글자로 되어있다. JWT의 핵심 목표는 사용자에 대한, 토큰에 대한 표현을 압축하는 것이기 때문에 이를 정의한 것이라고 볼 수 있다.

1. iss (Issuer) : 토큰 발급자
2. sub (Subject) : 토큰 제목 - 토큰에서 사용자에 대한 식별 값이 됨
3. aud (Audience) : 토큰 대상자
4. exp (Expiration Time) : 토큰 만료 시간
5. nbf (Not Before) : 토큰 활성 날짜 (이 날짜 이전의 토큰은 활성화되지 않음을 보장)
6. iat (Issued At) : 토큰 발급 시간
7. jti (JWT Id) : JWT 토큰 식별자 (issuer가 여러 명일 때 이를 구분하기 위한 값)

이러한 표준 스펙으로 정의되어있는 Claim 스펙이 있다는 것이지, 꼭 이 7가지를 모두 포함해야 하는 것은 아니고, 상황에 따라 해당 서버가 가져야 할 인증 체계에 따라 사용하면 된다.

여기서 중요한 것은 payload에 **민감한 정보를 담지 않는 것이다**

header와 payload는 특별한 암호화가 걸려있는 것이 아니기 때문에 누구나 jwt를 가지고 디코딩을 한다면 header나 payload에 담긴 값을 알 수 없기 떄문이다.

### Signature

가장 중요하다고 할 수 있는 서명은 지금까지 Header와 Player를 보여줄 때는 인코딩 되어있던 값을 위처럼 합치고 이를 서버가 가지고 있는 개인키를 가지고 암호화되어있는 상태이다.

따라서 signature는 서버에 있는 개인키로만 암호화를 풀 수 있으므로 다른 클라이언트는 임의로 Signature를 복호화할 수 없다

***

## 장점

- 이미 토큰 자체가 인증된 정보이기 때문에 세션 저장소와 같은 별도의 인증 저장소가 "필수적"으로 필요하지 않다

- 세션과는 다르게 클라이언트의 상태를 서버가 저장해 두지 않아도 된다

- signature를 공통 키 개인키 암호화를 통해 막아두었기 때문에 데이터에 대한 보완성이 늘어난다.

- 다른 서비스에 이용할 수 있는 공통적인 스펙으로써 사용할 수 있다.

***

## 단점

- 쿠키, 세션 때와 다르게 base64 인코딩을 통한 정보를 전달하므로 전달량이 많다. 따라서 네트워크 전달 시 많은 데이터양으로 부하가 생길 수 있다.

- payload에는 암호화가 되어있지 않기 떄문에 민감 정보를 저장할 수 없다.

- 토큰이 탈취당하면 만료될 떄까지 대처가 불가능하다.