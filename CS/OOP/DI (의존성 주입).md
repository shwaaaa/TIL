# DI (ì˜ì¡´ì„±ì£¼ì…)

## ì˜ì¡´ê´€ê³„ ì—­ì „ ì›ì¹™ (DPI : Dependency inversion principle)

ì˜ì¡´ê´€ê³„ ì—­ì „ ì›ì¹™ì€ SOLIDì˜ ë§ˆì§€ë§‰ ì›ì¹™ìœ¼ë¡œ ìƒìœ„ ëª¨ë“ˆì´ í•˜ìœ„ ëª¨ë“ˆì—ê²Œ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ì„¤ê³„í•˜ëŠ” ê²ƒì´ë‹¤.

ì¦‰, ìƒìœ„ ëª¨ë“ˆê³¼ í•˜ìœ„ ëª¨ë“ˆ ëª¨ë‘ ì¶”ìƒí™”ë¥¼ í†µí•´ ê°„ì ‘ì ìœ¼ë¡œ ì˜ì¡´í•˜ê²Œ ë§Œë“¤ì–´ì•¼ í•œë‹¤.
> - ìƒìœ„ ëª¨ë“ˆ: ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œ ì˜ì¡´í•˜ëŠ” ëª¨ë“ˆì„ ë§í•œë‹¤. (ë‹¤ë¥¸ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë“ˆ)
> - í•˜ìœ„ ëª¨ë“ˆ: ë‹¤ë¥¸ ëª¨ë“ˆì— ì˜ì¡´ë˜ëŠ” ëª¨ë“ˆì„ ë§í•œë‹¤. (ì„¸ë¶€ êµ¬í˜„ ë° ì¼ë¶€ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ëª¨ë“ˆ)

ë˜í•œ, ì¶”ìƒí™”ëŠ” ì„¸ë¶€ ì‚¬í•­(ë³€ìˆ˜, ë©”ì„œë“œ ë“±)ì— ì˜ì¡´í•´ì„œëŠ” ì•ˆë˜ë©°, ì„¸ë¶€ì‚¬í•­ì´ ì¶”ìƒí™”ë¥¼ ì˜ì¡´í•´ì•¼í•œë‹¤.

***

## ì˜ì¡´ì„±(Dependency)ì´ë€?

ì˜ì¡´ì„±ì´ë€, í•œ ê°ì²´ê°€ ë‹¤ë¥¸ ê°ì²´ì— ì˜ì¡´í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.

```swift
// í•˜ìœ„ ëª¨ë“ˆ
class Engine {
    func start() {
        print("ì—”ì§„ ê°€ë™")
    }
}

// ìƒìœ„ ëª¨ë“ˆ
class Car {
    // ğŸ‘‰ ê°•í•˜ê²Œ ê²°í•©
    let engine = Engine()

    func start() {
        // í•˜ìœ„ ëª¨ë“ˆì„ ì˜ì¡´
        engine.start()
        print("ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.")
    }
}

let myCar = Car()
myCar.start()

// ì—”ì§„
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.
```
ì—¬ê¸°ì„œ ìƒìœ„ ëª¨ë“ˆì€ Car í´ë˜ìŠ¤ì´ê³  í•˜ìœ„ ëª¨ë“ˆ Engine í´ë˜ìŠ¤ì´ë©°, Car ê°ì²´ëŠ” Engineì˜ ê°ì²´ì— ì˜ì¡´í•œë‹¤.

ì˜ì¡´ ê´€ê³„ê°€ ìƒê²¨ Carì™€ Engineì˜ ê°ì²´ê°€ ê°•í•˜ê²Œ ê²°í•©ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì˜ì¡´ê´€ê³„ ì—­ì „ ì›ì¹™ë„ ìœ„ë°˜í•˜ê²Œ ëœë‹¤.

ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë§Œì•½, ì—”ì§„ ëŒ€ì‹  ì „ê¸°ëª¨í„° ì°¨ëŸ‰ìœ¼ë¡œ ê°œì¡°ë¥¼ í•˜ê¸° ìœ„í•´ì„  ê¸°ì¡´ ì½”ë“œ(Car í´ë˜ìŠ¤)ë¥¼ ìˆ˜ì •í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìƒê¸°ê²Œ ëœë‹¤.

ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œëŠ”

Car í´ë˜ìŠ¤ê°€ Engine í´ë˜ìŠ¤ì— ì§ì ‘ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ì–´ ì¤˜ì•¼í•œë‹¤.

ê·¸ ë°©ë²•ì´ ë°”ë¡œ **ì˜ì¡´ì„± ì£¼ì… ë°©ë²•**ì´ë‹¤.

***

## ì˜ì¡´ì„± ì£¼ì…(DI : Dependency Injection)ì´ë€?

í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ì˜ì¡´í•˜ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼,

ì™¸ë¶€ì—ì„œ ìƒì„±í•œ í›„ ì˜ì¡´í•˜ëŠ” ê°ì²´ë¥¼ ì „ë‹¬ë°›ì•„ ì‚¬ìš©í•˜ëŠ” ë””ìì¸ íŒ¨í„´ì´ë‹¤.

ì´ë¥¼ í†µí•´ ê°ì²´ ê°„ì˜ ê²°í•©ë„ë¥¼ ë‚®ì¶”ê³ , ìœ ì—°í•˜ê³  í™•ì¥ì„± ìˆëŠ” ì„¤ê³„ê°€ ê°€ëŠ¥í•˜ë„ë¡ ë„ì™€ì¤€ë‹¤.

í¬ê²Œ 4ê°€ì§€ ë°©ë²•ì´ ìˆë‹¤.

1. ìƒì„±ì ì£¼ì…

2. í”„ë¡œí¼í‹° ì£¼ì…

3. ë©”ì„œë“œ ì£¼ì…

4. ì¸í„°í˜ì´ìŠ¤ ì£¼ì…

***

### ìƒì„±ì ì£¼ì…

ìƒì„±ìë¥¼ í†µí•´ íŒŒë¼ë¯¸í„° ê°’ìœ¼ë¡œ í•„ìš”í•œ ì˜ì¡´ì„±ì„ ë°›ì•„ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.

ë³´í†µ ì´ˆê¸°ì— ê¼­ í•„ìš”í•œ ë°ì´í„°ë‚˜ ê°ì²´ê°€ ìˆì„ ë•Œ ì‚¬ìš©ëœë‹¤.

```swift
class Engine {
    func start() {
        print("ì—”ì§„ ê°€ë™")
    }
}

class Car {
    private let engine: Engine
    
    init(engine: Engine) {
        self.engine = engine
    }

    func start() {
        engine.start()
        print("ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.")
    }
}

let engine = Engine()
let myCar = Car(engine: engine)
myCar.start()

// ì—”ì§„ ê°€ë™
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.
```

***

### í”„ë¡œí¼í‹° ì£¼ì…

ê°ì²´ë¥¼ ìƒì„±í•œ í›„ í”„ë¡œí¼í‹°ë¥¼ í†µí•´ ì˜ì¡´ì„±ì„ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ë‹¤.

```swift
class Engine {
    func start() {
        print("ì—”ì§„ ê°€ë™")
    }
}

class Car {
    var engine: Engine?
    
    func start() {
        engine?.start()
        print("ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.")
    }
}

let engine = Engine()
let myCar = Car()

// Car ì¸ìŠ¤í„´ìŠ¤ì˜ engine í”„ë¡œí¼í‹°ì— Engine ì¸ìŠ¤í„´ìŠ¤ í• ë‹¹
myCar.engine = engine
myCar.start()

// ì—”ì§„ ê°€ë™
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.
```

ë‹¨ì ìœ¼ë¡œëŠ” í´ë˜ìŠ¤ ë‚´ë¶€ì—ì„œ ì˜ì¡´ì„±ì„ ê°–ê³  ìˆëŠ” ê°ì²´ë¥¼ ìƒì„± ëª»í•˜ë¯€ë¡œ,

ì™¸ë¶€ì—ì„œ ìƒì„±ë˜ê¸° ì „ê¹Œì§€ ê°ì²´ë¥¼ ìƒì„± ë° ì „ë‹¬í•  ìˆ˜ ì—†ë‹¤.

ë˜í•œ, ë‹¤ë¥¸ ê³³ì—ì„œë„ engineë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ìº¡ìŠí™”ê°€ ê¹¨ì§€ê²Œ ëœë‹¤.

***

### ë©”ì„œë“œ ì£¼ì…

ì˜ì¡´ì„±ì´ í•„ìš”í•œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ë•Œ, í•´ë‹¹ ë©”ì„œë“œì— íŒŒë¼ë¯¸í„° ê°’ì— ì˜ì¡´ì„±ì„ ì „ë‹¬í•˜ëŠ” ë°©ì‹ì´ë‹¤.

```swift
class Engine {
    func start() {
        print("ì—”ì§„ ê°€ë™")
    }
}

class Car {
    // Engine í´ë˜ìŠ¤ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë°›ìŒ
    func start(with engine: Engine) {
        engine.start()
        print("ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.")
    }
}

let engine = Engine()
let myCar = Car()
// Engine í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ë‹¬í•¨
myCar.start(with: engine)

// ì—”ì§„ ê°€ë™
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.
```

ë‹¨ì ì€ í”„ë¡œí¼í‹° ì£¼ì… ë°©ì‹ê³¼ ë™ì¼í•˜ë‹¤.

***

### ì¸í„°í˜ì´ìŠ¤ ì£¼ì…

ì¸í„°í˜ì´ìŠ¤ë€? ê°ì²´ì™€ ê°ì²´ ì‚¬ì´ì˜ ìƒí˜¸ì‘ìš©ì„ ì •ì˜í•˜ëŠ” ì¶”ìƒì ì¸ ê°œë…ì´ë‹¤.

Swiftì—ì„œëŠ” ë³´í†µ Protocolë¥¼ ì´ìš©í•˜ì—¬ ì¶”ìƒí™”ë¥¼ ì‹œì¼œì¤€ë‹¤.

ê°ì²´ì˜ ë‚´ë¶€ êµ¬ì¡°ë‚˜ êµ¬í˜„ ë°©ì‹ì— ê´€ê³„ì—†ì´ ì™¸ë¶€ì—ì„œ ê°ì²´ë¥¼ ë‹¤ë£° ìˆ˜ ìˆê²Œ ë„ì™€ì¤€ë‹¤.

```swift
// í”„ë¡œí† ì½œ ì •ì˜
protocol EngineProtocol {
    func start()
}

// í•˜ìœ„ ëª¨ë“ˆ - í”„ë¡œí† ì½œ ì±„íƒ
class Engine: EngineProtocol {
    func start() {
        print("ì—”ì§„ ê°€ë™")
    }
}

// ìƒìœ„ ëª¨ë“ˆ - ìƒì„± ì‹œ í”„ë¡œí† ì½œì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ
class Car {
    private let engine: EngineProtocol
    
    init(engine: EngineProtocol) {
        self.engine = engine
    }
    
    func start() {
        // í”„ë¡œí† ì½œì„ ì´ìš©í•´ í•˜ìœ„ ëª¨ë“ˆì˜ ë©”ì„œë“œ ì‚¬ìš©
        engine.start()
        print("ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.")
    }
}

let engine = Engine()
let myCar = Car(engine: engine)
myCar.start()

// ì—”ì§„ ê°€ë™
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.
```

ì¸í„°í˜ì´ìŠ¤ ì£¼ì… íŒ¨í„´ì„ ì‚¬ìš©í•˜ë©´, ì„œë¡œ ê¸´ë°€í•˜ê²Œ ì—°ê²°ëœ ì˜ì¡´ì„±ì´ ì•½í•´ì ¸ ìœ ì§€ë³´ìˆ˜ ë° í™•ì¥ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤.

'ì˜ì¡´ì„±' -> 'ì˜ì¡´ì„± ì£¼ì…'ìœ¼ë¡œ ë³€ê²½í•˜ë©´ ì–´ë–¤ ì°¨ì´ê°€ ìˆëŠ”ì§€, ì½”ë“œë¥¼ ì¶”ê°€í•´ í™•ì¸í•´ë³´ë©´,

ì¸í„°í˜ì´ìŠ¤ ì£¼ì… íŒ¨í„´ì„ ì´ìš©í•˜ì—¬, ì´ë²ˆì—ë„ ì „ê¸°ì°¨ë¡œ ê°œì¡°ë¥¼ ì‹œì¼œë³´ë©´

ì´ì™€ ê°™ì´, ìƒìœ„ ëª¨ë“ˆì˜ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  í™•ì¥ì´ ìš©ì´í•´ì§€ë©° ê¹”ë”í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

```swift
// í”„ë¡œí† ì½œ ì •ì˜
protocol EngineProtocol {
    func start()
}

// í•˜ìœ„ ëª¨ë“ˆ - ê°€ì†”ë¦° ì—”ì§„
class GasolineEngine: EngineProtocol {
    func start() {
        print("ê°€ì†”ë¦° ì—”ì§„ ê°€ë™")
    }
}

// í•˜ìœ„ ëª¨ë“ˆ - ì „ê¸° ëª¨í„° (ì¶”ê°€)
class ElectricMotor: EngineProtocol {
    func start() {
        print("ì „ê¸°ëª¨í„° ê°€ë™")
    }
}

// ìƒìœ„ ëª¨ë“ˆ
class Car {
    private let engine: EngineProtocol
    
    init(engine: EngineProtocol) {
        self.engine = engine
    }
    
    func start() {
        // í”„ë¡œí† ì½œì„ ì´ìš©í•´ í•˜ìœ„ ëª¨ë“ˆì˜ ë©”ì„œë“œ ì‚¬ìš©
        engine.start()
        print("ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.")
    }
}

let gasoline = GasolineEngine()
let motor = ElectricMotor()

let myGasolineCar = Car(engine: gasoline)
let myElectricCar = Car(engine: motor)

myGasolineCar.start()
// ê°€ì†”ë¦° ì—”ì§„ ê°€ë™
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.

myElectricCar.start()
// ì „ê¸°ëª¨í„° ê°€ë™
// ì°¨ê°€ ì¶œë°œí•©ë‹ˆë‹¤.
```